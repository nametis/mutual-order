{% extends "base.html" %}

{% block title %}Commande {{ order.seller_name }} - MUTUAL ORDER{% endblock %}

{% block head %}
<script>
    window.currentUserId = {{ current_user.id }};
    window.isAdmin = {{ 'true' if current_user.is_admin else 'false' }};
    window.orderData = {{ order | tojson | safe }};
</script>
{% endblock %}

{% block content %}
<script src="{{ url_for('static', filename='js/orderApp.js') }}"></script>

<div x-data="orderApp()" x-init="init()" class="min-h-screen">

  <!-- Main content -->
  <div x-show="!loading" x-cloak>
    <div class="lg:col-span-2">
      {% include 'components/order_v2/info_section.html' %}
      {% include 'components/order_v2/add_listing_section.html' %}
      {% include 'components/order_v2/validation_section.html' %}

      <!-- Embedded chat -->
      <div x-show="order.status !== 'building'" class="bg-white rounded-lg shadow mt-6">
        {% include 'components/order_v2/chat_embedded.html' %}
      </div>

      {% include 'components/order_v2/listings_section.html' %}
    </div>

    <div class="lg:col-span-1 space-y-6">
      {% include 'components/order_v2/status_section.html' %}
      {% include 'components/order_v2/participants_section.html' %}
      {% include 'components/order_v2/order_summary_section.html' %}
      {% include 'components/order_v2/admin_section.html' %}
    </div>
  </div>

  <!-- Floating chat panel -->
  <div x-show="showChat" x-cloak class="fixed inset-0 bg-black bg-opacity-50 z-50" @click="toggleChat()">
    <div @click.stop class="fixed right-0 top-0 bottom-0 w-96 bg-white flex flex-col">
      {% include 'components/order_v2/chat_floating.html' %}
    </div>
  </div>

</div>
{% endblock %}
