<!-- templates/components/order_v2/modals.html -->

<!-- Full Chat Panel Modal -->
<div x-show="showChat" x-cloak class="fixed inset-0 bg-black bg-opacity-50 z-50" @click="toggleChat()">
    <div @click.stop="" class="fixed right-4 top-4 bottom-4 w-96 bg-white rounded-lg shadow-xl flex flex-col">
        <!-- Chat Header -->
        <div class="bg-blue-600 text-white p-4 rounded-t-lg">
            <div class="flex justify-between items-center">
                <div>
                    <h3 class="font-semibold">ðŸ’¬ Discussion</h3>
                    <p class="text-sm opacity-90" x-text="'Commande ' + order.seller_name"></p>
                </div>
                <button @click="toggleChat()" class="text-white hover:text-gray-200">âœ•</button>
            </div>
        </div>
        
        <!-- Chat Messages -->
        <div class="flex-1 overflow-y-auto p-4 space-y-4" x-ref="chatMessages">
            <template x-for="message in chatMessages" :key="'modal_' + message.id">
                <div class="max-w-xs p-3 rounded-lg"
                     :class="message.is_own ? 'bg-blue-100 ml-auto' : 'bg-gray-100'">
                    <div class="font-semibold text-sm" x-text="message.username"></div>
                    <div class="text-sm" x-text="message.content"></div>
                    <div class="text-xs text-gray-500 mt-1" x-text="message.timestamp"></div>
                </div>
            </template>
            
            <!-- Empty State -->
            <div x-show="chatMessages.length === 0" class="text-center text-gray-500 py-8">
                <div class="text-4xl mb-2">ðŸ’¬</div>
                <p>Aucun message pour le moment</p>
                <p class="text-sm">Commencez la discussion !</p>
            </div>
        </div>
        
        <!-- Chat Input -->
        <div class="border-t p-4">
            <div class="flex space-x-2">
                <input x-model="newMessage" 
                       @keydown.enter="sendMessage()" 
                       type="text" 
                       placeholder="Votre message..." 
                       maxlength="500"
                       class="flex-1 px-3 py-2 border border-gray-300 rounded-full focus:ring-2 focus:ring-blue-500">
                <button @click="sendMessage()" 
                        :disabled="!newMessage.trim()"
                        class="bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700 disabled:opacity-50">
                    ðŸ“¤
                </button>
            </div>
            
            <!-- Character counter -->
            <div x-show="newMessage.length > 400" class="text-right mt-1">
                <span class="text-xs" 
                      :class="newMessage.length > 500 ? 'text-red-500' : 'text-gray-500'"
                      x-text="newMessage.length + '/500'"></span>
            </div>
        </div>
    </div>
</div>

<!-- Quick Edit Modals -->
<div x-show="editField" x-cloak class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center" @click="editField = null">
    <div @click.stop="" class="bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl">
        <h3 class="text-lg font-bold mb-4">Modification rapide</h3>
        
        <!-- Edit Deadline -->
        <div x-show="editField === 'deadline'">
            <label class="block text-sm font-medium text-gray-700 mb-2">Date limite</label>
            <input type="date" x-model="adminForm.deadline" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
        </div>
        
        <!-- Edit Location -->
        <div x-show="editField === 'location'">
            <label class="block text-sm font-medium text-gray-700 mb-2">Localisation</label>
            <input type="text" x-model="adminForm.user_location" 
                   placeholder="Ex: Paris, Lyon, Marseille..."
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
        </div>
        
        <!-- Edit PayPal Link -->
        <div x-show="editField === 'paypal'">
            <label class="block text-sm font-medium text-gray-700 mb-2">Lien PayPal.me</label>
            <input type="url" x-model="adminForm.paypal_link" 
                   placeholder="https://paypal.me/votrenom"
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            <div class="text-xs text-gray-500 mt-1">Laissez vide pour dÃ©sactiver</div>
        </div>
        
        <!-- Edit Discount -->
        <div x-show="editField === 'discount'">
            <label class="block text-sm font-medium text-gray-700 mb-2">Discount (â‚¬)</label>
            <input type="number" x-model="adminForm.discount" 
                   step="0.01" min="0" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            <div class="text-xs text-gray-500 mt-1">RÃ©duction appliquÃ©e au total de la commande</div>
        </div>
        
        <!-- Modal Actions -->
        <div class="flex space-x-3 mt-6">
            <button @click="editField = null" 
                    class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                Annuler
            </button>
            <button @click="updateOrderSettings(); editField = null" 
                    class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                Sauvegarder
            </button>
        </div>
    </div>
</div>