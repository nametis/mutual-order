<!-- templates/components/order_v2/listings_section.html -->

<!-- Add Listing Section (building phase only)-->
<div x-show="order.status === 'building'" class="bg-white rounded-lg shadow p-6">
    <div class="flex flex-col sm:flex-row sm:items-baseline space-y-4 sm:space-y-0 sm:space-x-4 mb-4">
        <h3 class="flex items-center space-x-2 text-xl font-bold text-gray-900">
            <span class="bg-yellow-100 px-3 py-1 rounded-full">
                <span>âž•</span>
                <span>Ajouter un disque</span>
            </span>
        </h3>
        <a :href="'https://www.discogs.com/seller/' + order.seller_name + '/profile'" target="_blank"
           class="flex items-center space-x-1 px-3 py-1 bg-white border border-black rounded-full text-black hover:bg-gray-50 text-xs transition-colors">
            <span>ðŸ‘¤</span>
            <span class="hidden sm:inline">Voir les autres disques du vendeur</span>
            <span class="sm:hidden">Voir vendeur</span>
        </a>
    </div>
    
    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
        <input x-model="newListingUrl" type="url" 
            placeholder="Coller l'URL de l'annonce Discogs..."
            @keydown.enter="addListing()"
            class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
        <button @click="addListing()" 
                :disabled="!newListingUrl.trim()"
                class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
            <span class="hidden sm:inline">Ajouter Ã  la commande</span>
            <span class="sm:hidden">Ajouter</span>
        </button>
    </div>
</div>

<!-- My Discs Section -->
<div x-show="myListings.length > 0" class="bg-white rounded-lg shadow overflow-hidden">
    <div class="bg-gradient-to-r from-yellow-400 to-orange-400 px-6 py-4">
        <div class="flex items-center justify-between">
            <h3 class="flex items-center space-x-2 text-xl font-bold text-white">
                <span>ðŸ’¿</span>
                <span>Mes disques</span>
                <span class="bg-white bg-opacity-20 px-2 py-1 rounded-full text-sm" x-text="myListings.length"></span>
            </h3>
            <button x-show="order.status === 'building'" @click="verifyAvailability()"
                    class="flex items-center space-x-1 px-3 py-1 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full text-white text-xs transition-colors">
                <span>ðŸ”„</span>
                <span class="hidden sm:inline">VÃ©rifier dispo</span>
            </button>
        </div>
    </div>
    
    <!-- Desktop Table -->
    <div class="hidden lg:block">
        <table class="min-w-full">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pochette</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Titre</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prix</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ã‰tat Vinyle</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ã‰tat Pochette</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                <template x-for="listing in myListings" :key="'my_' + listing.id">
                    <tr class="hover:bg-gray-50 transition-colors">
                        <!-- Cover Image -->
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center space-x-2">
                                <a :href="listing.listing_url" target="_blank"
                                    class="p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-full transition-colors"
                                    title="Voir sur Discogs">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z" />
                                        <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z" />
                                    </svg>
                                </a>
                                <button x-show="order.status === 'building' && (listing.user_id === currentUserId || order.creator_id === currentUserId || isAdmin)" 
                                        @click="removeListing(listing.id)"
                                        class="p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-full transition-colors"
                                        title="Retirer le disque"
                                        onclick="return confirm('ÃŠtes-vous sÃ»r de vouloir retirer ce disque ?')">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 11-2 0v6a1 1 0 112 0V8z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>
    
    <!-- Mobile Cards for Other Listings -->
    <div class="lg:hidden">
        <template x-for="listing in otherListings" :key="'other_mobile_' + listing.id">
            <div class="border-b border-gray-200 p-4 hover:bg-gray-50 transition-colors">
                <div class="flex space-x-4">
                    <div class="relative flex-shrink-0">
                        <img x-show="listing.image_url" 
                             :src="listing.image_url" 
                             :alt="listing.title"
                             class="w-20 h-20 object-cover rounded-lg shadow-sm">
                        <div x-show="!listing.image_url" 
                             class="w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400">
                            <span class="text-2xl">ðŸŽµ</span>
                        </div>
                        <div x-show="listing.status !== 'For Sale'"
                             class="absolute inset-0 bg-red-500 bg-opacity-80 rounded-lg flex items-center justify-center">
                            <span class="text-white text-xs font-bold">INDISPO</span>
                        </div>
                    </div>

                    <div class="flex-1 min-w-0">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex-1 min-w-0">
                                <h4 class="font-medium text-gray-900 truncate" x-text="listing.title"></h4>
                                <p class="text-sm text-gray-500 font-mono">ID: <span x-text="listing.discogs_id"></span></p>
                            </div>
                            <div class="ml-4 flex-shrink-0">
                                <div class="text-lg font-bold text-gray-900" x-text="listing.price_value.toFixed(2) + 'â‚¬'"></div>
                            </div>
                        </div>

                        <div class="flex flex-wrap gap-2 mb-3">
                            <div class="flex items-center space-x-1">
                                <span class="text-xs text-gray-500">Vinyle:</span>
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                      :class="getConditionClass(listing.media_condition)"
                                      x-text="getShortCondition(listing.media_condition)"></span>
                            </div>
                            <div class="flex items-center space-x-1">
                                <span class="text-xs text-gray-500">Pochette:</span>
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                      :class="getConditionClass(listing.sleeve_condition)"
                                      x-text="getShortCondition(listing.sleeve_condition)"></span>
                            </div>
                        </div>

                        <div x-show="listing.user_id !== currentUserId" class="mb-3">
                            <div class="flex items-center space-x-1">
                                <span class="text-xs text-gray-500">AjoutÃ© par:</span>
                                <span class="text-xs font-medium text-gray-700" x-text="listing.username"></span>
                            </div>
                        </div>

                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <a :href="listing.listing_url" target="_blank"
                                    class="flex items-center space-x-1 text-blue-600 hover:text-blue-800 text-sm transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z" />
                                        <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z" />
                                    </svg>
                                    <span>Voir sur Discogs</span>
                                </a>
                            </div>

                            <button x-show="order.status === 'building' && (listing.user_id === currentUserId || order.creator_id === currentUserId || isAdmin)" 
                                    @click="removeListing(listing.id)"
                                    class="flex items-center space-x-1 text-red-600 hover:text-red-800 text-sm transition-colors"
                                    onclick="return confirm('ÃŠtes-vous sÃ»r de vouloir retirer ce disque ?')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 11-2 0v6a1 1 0 112 0V8z" clip-rule="evenodd" />
                                </svg>
                                <span>Retirer</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </template>
    </div>
</div>">
                            <div class="relative group">
                                <img x-show="listing.image_url" 
                                     :src="listing.image_url" 
                                     :alt="listing.title"
                                     class="w-16 h-16 object-cover rounded-lg shadow-sm group-hover:shadow-md transition-shadow"
                                     loading="lazy">
                                <div x-show="!listing.image_url" 
                                     class="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400">
                                    <span class="text-2xl">ðŸŽµ</span>
                                </div>
                                <!-- Status indicator -->
                                <div x-show="listing.status !== 'For Sale'"
                                     class="absolute inset-0 bg-red-500 bg-opacity-80 rounded-lg flex items-center justify-center">
                                    <span class="text-white text-xs font-bold">INDISPO</span>
                                </div>
                            </div>
                        </td>

                        <!-- Title & ID -->
                        <td class="px-6 py-4">
                            <div class="max-w-xs">
                                <div class="font-medium text-gray-900 truncate" x-text="listing.title" :title="listing.title"></div>
                                <div class="text-sm text-gray-500 font-mono">ID: <span x-text="listing.discogs_id"></span></div>
                            </div>
                        </td>

                        <!-- Price -->
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-lg font-bold text-gray-900" x-text="listing.price_value.toFixed(2) + 'â‚¬'"></div>
                        </td>

                        <!-- Media Condition -->
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                  :class="getConditionClass(listing.media_condition)"
                                  x-text="getShortCondition(listing.media_condition)"></span>
                        </td>

                        <!-- Sleeve Condition -->
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                  :class="getConditionClass(listing.sleeve_condition)"
                                  x-text="getShortCondition(listing.sleeve_condition)"></span>
                        </td>

                        <!-- Actions -->
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center space-x-2">
                                <a :href="listing.listing_url" target="_blank"
                                    class="p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-full transition-colors"
                                    title="Voir sur Discogs">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z" />
                                        <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z" />
                                    </svg>
                                </a>

                                <button x-show="order.status === 'building' && (listing.user_id === currentUserId || order.creator_id === currentUserId || isAdmin)" 
                                        @click="removeListing(listing.id)"
                                        class="p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-full transition-colors"
                                        title="Retirer le disque"
                                        onclick="return confirm('ÃŠtes-vous sÃ»r de vouloir retirer ce disque ?')">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 11-2 0v6a1 1 0 112 0V8z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>
    
    <!-- Mobile Cards -->
    <div class="lg:hidden">
        <template x-for="listing in myListings" :key="'my_mobile_' + listing.id">
            <div class="border-b border-gray-200 p-4 hover:bg-gray-50 transition-colors">
                <div class="flex space-x-4">
                    <!-- Cover Image -->
                    <div class="relative flex-shrink-0">
                        <img x-show="listing.image_url" 
                             :src="listing.image_url" 
                             :alt="listing.title"
                             class="w-20 h-20 object-cover rounded-lg shadow-sm"
                             loading="lazy">
                        <div x-show="!listing.image_url" 
                             class="w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400">
                            <span class="text-2xl">ðŸŽµ</span>
                        </div>
                        <!-- Status indicator overlay -->
                        <div x-show="listing.status !== 'For Sale'"
                             class="absolute inset-0 bg-red-500 bg-opacity-80 rounded-lg flex items-center justify-center">
                            <span class="text-white text-xs font-bold">INDISPO</span>
                        </div>
                    </div>

                    <!-- Content -->
                    <div class="flex-1 min-w-0">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex-1 min-w-0">
                                <h4 class="font-medium text-gray-900 truncate" x-text="listing.title" :title="listing.title"></h4>
                                <p class="text-sm text-gray-500 font-mono">ID: <span x-text="listing.discogs_id"></span></p>
                            </div>
                            <div class="ml-4 flex-shrink-0">
                                <div class="text-lg font-bold text-gray-900" x-text="listing.price_value.toFixed(2) + 'â‚¬'"></div>
                            </div>
                        </div>

                        <!-- Conditions -->
                        <div class="flex flex-wrap gap-2 mb-3">
                            <div class="flex items-center space-x-1">
                                <span class="text-xs text-gray-500">Vinyle:</span>
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                      :class="getConditionClass(listing.media_condition)"
                                      x-text="getShortCondition(listing.media_condition)"></span>
                            </div>
                            <div class="flex items-center space-x-1">
                                <span class="text-xs text-gray-500">Pochette:</span>
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                      :class="getConditionClass(listing.sleeve_condition)"
                                      x-text="getShortCondition(listing.sleeve_condition)"></span>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <a :href="listing.listing_url" target="_blank"
                                    class="flex items-center space-x-1 text-blue-600 hover:text-blue-800 text-sm transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z" />
                                        <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z" />
                                    </svg>
                                    <span>Voir sur Discogs</span>
                                </a>
                            </div>

                            <button x-show="order.status === 'building' && (listing.user_id === currentUserId || order.creator_id === currentUserId || isAdmin)" 
                                    @click="removeListing(listing.id)"
                                    class="flex items-center space-x-1 text-red-600 hover:text-red-800 text-sm transition-colors"
                                    onclick="return confirm('ÃŠtes-vous sÃ»r de vouloir retirer ce disque ?')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 11-2 0v6a1 1 0 112 0V8z" clip-rule="evenodd" />
                                </svg>
                                <span>Retirer</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </template>
    </div>
</div>

<!-- Other Discs Section -->
<div x-show="otherListings.length > 0" class="bg-white rounded-lg shadow overflow-hidden">
    <div class="bg-gradient-to-r from-blue-400 to-purple-400 px-6 py-4">
        <h3 class="flex items-center space-x-2 text-xl font-bold text-white">
            <span>ðŸŽµ</span>
            <span>Les autres disques dans la commande</span>
            <span class="bg-white bg-opacity-20 px-2 py-1 rounded-full text-sm" x-text="otherListings.length"></span>
        </h3>
    </div>
    
    <!-- Desktop Table for Other Listings -->
    <div class="hidden lg:block">
        <table class="min-w-full">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pochette</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Titre</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prix</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ã‰tat Vinyle</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ã‰tat Pochette</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">AjoutÃ© par</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                <template x-for="listing in otherListings" :key="'other_' + listing.id">
                    <tr class="hover:bg-gray-50 transition-colors">
                        <!-- Reuse same structure as my listings, but include "Added by" column -->
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="relative group">
                                <img x-show="listing.image_url" 
                                     :src="listing.image_url" 
                                     :alt="listing.title"
                                     class="w-16 h-16 object-cover rounded-lg shadow-sm group-hover:shadow-md transition-shadow">
                                <div x-show="!listing.image_url" 
                                     class="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400">
                                    <span class="text-2xl">ðŸŽµ</span>
                                </div>
                                <div x-show="listing.status !== 'For Sale'"
                                     class="absolute inset-0 bg-red-500 bg-opacity-80 rounded-lg flex items-center justify-center">
                                    <span class="text-white text-xs font-bold">INDISPO</span>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="max-w-xs">
                                <div class="font-medium text-gray-900 truncate" x-text="listing.title"></div>
                                <div class="text-sm text-gray-500 font-mono">ID: <span x-text="listing.discogs_id"></span></div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-lg font-bold text-gray-900" x-text="listing.price_value.toFixed(2) + 'â‚¬'"></div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                  :class="getConditionClass(listing.media_condition)"
                                  x-text="getShortCondition(listing.media_condition)"></span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                  :class="getConditionClass(listing.sleeve_condition)"
                                  x-text="getShortCondition(listing.sleeve_condition)"></span>
                        </td>
                        <td class="px-4 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900 font-medium" x-text="listing.username"></div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap