<!-- Embedded Chat Section (ordered/delivered/closed phases - before disc listings) -->
<div x-show="['ordered', 'delivered', 'closed'].includes(order.status)" class="bg-white rounded-lg shadow mt-6">
    <div class="bg-blue-600 text-white p-4 rounded-t-lg">
        <div class="flex justify-between items-center">
            <div>
                <h3 class="font-semibold">ðŸ’¬ Discussion de la commande</h3>
                <p class="text-sm opacity-90" x-text="'Commande ' + order.seller_name"></p>
            </div>
            <span x-show="unreadCount > 0"
                class="bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center">
                <span x-text="unreadCount > 99 ? '99+' : unreadCount"></span>
            </span>
        </div>
    </div>
    <div class="max-h-96 overflow-y-auto p-4 space-y-4" x-ref="embeddedChatMessages">
        <template x-for="message in chatMessages.slice(-10)" :key="message.id">
            <div class="max-w-xs p-3 rounded-lg"
                :class="message.is_own ? 'bg-blue-100 ml-auto' : 'bg-gray-100'">
                <div class="font-semibold text-sm" x-text="message.username"></div>
                <div class="text-sm" x-text="message.content"></div>
                <div class="text-xs text-gray-500 mt-1" x-text="message.timestamp"></div>
            </div>
        </template>
        <div x-show="chatMessages.length === 0" class="text-center text-gray-500 py-8">
            Aucun message pour le moment. Soyez le premier Ã  Ã©crire !
        </div>
    </div>
    <div class="border-t p-4">
        <div class="flex space-x-2">
            <input x-model="newMessage" @keydown.enter="sendMessage()" 
                type="text" placeholder="Votre message..." maxlength="500"
                class="flex-1 px-3 py-2 border rounded-full focus:ring-2 focus:ring-blue-500">
            <button @click="sendMessage()" 
                    class="bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700">
                ðŸ“¤
            </button>
        </div>
    </div>
</div>